# 天猫交易-下单（地址创建器）
* 文档版本号：1.0.0

## 总览
* 作者：仙羽

### 功能
* 被地址管理器组件调用`buy-order/biz/addr`，在无地址用户&无可用地址用户（商超被过滤）&用户新建地址时调用
* 调用通用组件`buy-base/util/popup`弹出浮层
* 构建浮层内容，调用淘系通用地址显示组件`member/address`构建具体地址选择器
* 提供前端错误校验和后端校验结果的返回的显示

### 函数
#### 外部函数
* `open` 初始化函数，弹出浮层，构建地址选择器内容，绑定响应，焦点置于详细地址输入框
  * **难点&业务点解析**
    * 整个地址栏是一个form，使用最基本的form提交
    * 由`isSubmiting`来控制整个提交的状态，等为true时，为发出xhr请求，等待结果
    * `addrControlData`由调用者`buy-order/biz/addr`提供，包含了地址的过滤信息和提示信息
    * 新建地址的`国家`-`省`-`市`-`区` `姓名`-`手机`-`邮编`的初始值从用户当前地址获取
    * 焦点置于详细地址输入框
* `show` 显示整个浮层
* `hide` 关闭浮层

#### 外部函数
* `showPopup` & `hidePopup` 无则创建、有则显示&隐藏地址浮层
* `initPopup` 初始化整个浮层
  * **难点&业务点解析**
    * 所在区域，有5个select分别代表如下意思
      * `#J_Province`     省       （国内地址默认展示的第一部位，当点击海外选项，自身隐藏，显示国家选择器）
      * `#J_Country`      国       （国外地址默认展示的第一部位）
      * `#J_ProvinceExt`  国外的省 （如果当前国家支持省选择会弹出，例如马来西亚）
      * `#addrCity`       市       （台湾和澳门某些地区没有市，省下面就是区。某些国家支持市选择）
      * `#addrDist`       区        (北京，天津，澳门等某些地址没有区级。某些国家支持区选择)
    * `var addrSelector = AddrSelector`为调用统一的地址选择器，主要参数
      * `overseaPy : false,`海外地址显示英文地面：false
      * `filter` 会对每个地址都调用一次过滤判断，如果该地址的所以低级地址都被过滤了，那么高级地址也不显示。返回true标示不会被过滤。
        * 其中`990100`为海外这个标记符地址，会直接被过滤
    * `var validates = {`是前端校验
    * `IO({` 是发生请求
      * 其中`divisionCode`是当前地址可用的最小的地址的变化（从区取到国）
      * 当成功后，组装成和`orderData`里的addrData的模式，用于前端渲染。实际上该时候触发了前端的地址变更操作，会进行局部刷新，这个前端渲染的主要职责就是更新当前地址的数据。当全局刷新完毕后，当前地址不会变更。（全局刷新不会重新渲染地址）
* `addErr`在地址选择器的特定位置显示错误信息
* `clearErr`清除指定位置的错误提示

### 本文档相关：
* 修改记录：
  * 130903 承风 创建了文档






