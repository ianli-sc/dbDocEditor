# 天猫交易-下单（数量控制）
* 文档版本号：1.0.0

## 总览
* 作者：仙羽

### 功能
* 显示：
  * 当购物车下单 和 周期购商品 和 网厅的商品，不能修改数量（有返回购物车，购物车里面可以改），直接显示amount.now
  * 当立即购买时调用数量控件来调整购买数
* 提示：（文案可能调整）
  * 当用户ID被限购（某些商品每个ID只能买特定数量），显示`该商品最多购买`amount.maxLimit数
  * 当用户数量变成最大可用数，显示`该商品限购`or`最多只能购买`amount.max件。（由库存等决定）
* 控制:
  * 用户输入数量 >   最大可购买数，自动将数量置为最大可买数，+号失效
  * 用户输入数量 <=  0           ，自动设置为0
  * 用户改变数据大小时发送异步请求，如果异步请求失败，数量回滚到上次有效的数量，显示提示

### 函数
#### 外部函数
* `init` 初始化数量，此时dom已经渲染完成，绑定输入框的事件，执行数量检查
  * 本次执行检查，可以判断是否ID限购或者是否限购，以显示错误文案
* `plus` & `minus` 改变数量，执行数量变更的检查。
* `render` 渲染数量

#### 内部函数
* `execute` 执行数量检查
  * **参数**
    * `rootEl` : 数量选择器的根节点
    * `diff`:数量的调整量（数量相对于之前的该变量）
  * **难点&业务点解析**
    * 输入的数量如果非数字，那么直接还原
    * 入住值 >= 最大可购买数，报错，改变成最大数量，改变+-按钮
    * 发送数量变更`change` event，触发局部更新，更新总价，优惠等
* `addErr` 添加错误提示
* `removeErr` 移除错误提示

#### 触发event
* `Model.on('fillOrderData`当局部刷新返回，model会发送该event，更新最大可购买数
* `Model.on('updateOrderData`当局部刷新返回，model会发送该event，更新总价
* `Model.on('beforeUpdateOrderData`当局部刷新返回，model填充数据前会发送该event，更新总价当前数量
* `Model.on('partError`当局部出错，model会发送该event，回滚当修改前的数量
### 本文档相关：
* 修改记录：
  * 130903 承风 创建了文档






