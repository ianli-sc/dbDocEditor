# 天猫交易-下单（支付方式）
* 文档版本号：1.0.0

## 总览
* 作者：仙羽

### 功能
* 付款方式分为`货到付款`，`分期付款`，`找人代付`，`匿名购买`
  * 其中前三种付款方式是互斥的
  * 可能全部出现，也可能都不出现，受购买的商品所支持的支付方式决定
* `匿名购买`是默认选中的，**且不是在此渲染的（有点乱）**。特定类目的商品`匿名购买`是强制选择的
* `货到付款`方式，会导致触发`isCod`响应，改变配送方式、运费险、价格、提交按钮等内容
* `分期付款`会展示支持分期付款的银行的图片
  * 在出现后，可用（可勾选）的条件为`价格超过600块`
  * 当使用分期付款时，提交订单会跳转到网页支付页面，而非支付宝+网页的合体页面
* 此外天猫点券卡的渲染部分也放在这个模块，后续将移出去，在此不做详细描述


### 函数
#### 外部函数
* `init` 初始化
  * 检测下是否为分期付款（分期付款可在购物车中选择并传递过来）
* `render` 渲染支付方式的dom
  * 通过Model内获取orderData的标志位来判定每种支付方式是否出现
  * 调用内部函数`renderOne`来渲染统一长相的dom
* `select` 选择某种支付方式的监听函数，实现互斥
* `mark` 更新closure内的值，标示该付款方式的可用性

#### 内部函数
* `renderOne`渲染每个选择框
* `testEnable`检验某个付款方式是否可用
* `walk`遍历所有的付款类型复选框
* `updateStatus`当选择某个付款方式后更新每个剩余付款方式的值
* `handlerIsCod`处理货到付款的内容
* `testFenqiFee`判定金额是否满足分期付款

#### 事件监听
* `Paytype.on('updateFenqi', function(vo){`使用分期，展示图片
* `Model.on('after_actualPaidChange'`实付款变化，判定是否启用分期
* `Model.on('afterIsCodChange', handlerIsCod);`配送方式变成`货到付款`进行cod处理
* `Model.on('afterIsSupportAgentPayChange'`找人代付的开关，控制跳转支付宝的页面
### 本文档相关：
* 修改记录：
  * 130903 承风 创建了文档






